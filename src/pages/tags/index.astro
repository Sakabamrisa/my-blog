---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Tag from "@/components/Tag.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import getUniqueTags from "@/utils/getUniqueTags";
import { SITE } from "@/config";

const posts = await getCollection("blog");
let tags = getUniqueTags(posts);
---

<Layout title={`标签 | ${SITE.title}`}>
  <Header />
  
  <style>
    /* ========== 页面级进入动画 ========== */
    .fade-in-up {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }
    @keyframes fadeInUp {
      to { opacity: 1; transform: translateY(0); }
    }

    /* ========== 科技感时间轴动画 ========== */
    /* 主轴线向下生长 */
    .draw-line {
      transform-origin: top;
      transform: scaleY(0);
      animation: drawLine 1.2s cubic-bezier(0.25, 1, 0.5, 1) forwards;
      animation-delay: 0.1s;
    }
    @keyframes drawLine {
      to { transform: scaleY(1); }
    }

    /* ========== 标签特化：极速级联弹出 ========== */
    .tag-item {
      opacity: 0;
      /* 起始状态稍微偏左且缩小，制造 Q 弹的科技感 */
      transform: translateX(-15px) scale(0.9);
      animation: slidePop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      transition: transform 0.2s ease, filter 0.2s ease;
    }
    @keyframes slidePop {
      to { opacity: 1; transform: translateX(0) scale(1); }
    }
    
    /* 标签悬浮微动效 */
    .tag-item:hover {
      transform: translateY(-3px) scale(1.05);
      filter: drop-shadow(0 4px 6px rgba(var(--color-accent-rgb), 0.3));
      z-index: 10;
    }
  </style>

  <!-- 页面主体容器，限制最大宽度以保持阅读舒适度 -->
  <main id="main-content" class="app-layout py-12 min-h-[70vh] max-w-3xl mx-auto px-4 sm:px-8">
    
    <!-- 顶部标题区域 -->
    <section class="mb-12 fade-in-up">
      <div class="flex items-center gap-4 mb-3">
        <div class="w-2 h-10 bg-accent rounded-full shadow-[0_0_15px_rgba(var(--color-accent-rgb),0.5)]"></div>
        <h1 class="text-4xl font-bold tracking-wide">标签</h1>
      </div>
      <div class="pl-6 ml-1 border-l-2 border-accent/20">
        <p class="text-lg opacity-70 font-medium tracking-wide">
          文章中使用的所有标签集合。
        </p>
      </div>
    </section>

    <!-- 标签云区域 (挂载在能量线上) -->
    <section class="relative fade-in-up" style="animation-delay: 0.2s;">
      
      <!-- 贯穿全列表的主线 (动态生长) -->
      <div class="absolute left-[3px] sm:left-[11px] top-4 bottom-[-20px] w-[2px] bg-gradient-to-b from-accent via-accent/30 to-transparent draw-line z-0"></div>

      <div class="relative pl-8 sm:pl-10 pt-2 pb-8">
        
        <!-- 扫描起始点：科技感发光圆点 -->
        <div class="absolute left-[-2px] sm:left-1 top-4 w-3 h-3 rounded-full border-2 border-accent bg-skin-base z-10 transition-all duration-300">
          <div class="absolute inset-0 bg-accent/40 rounded-full animate-ping" style="animation-duration: 2s;"></div>
        </div>

        <!-- 标签网格容器 -->
        <ul class="flex flex-wrap gap-4 pt-1">
          {tags.map(({ tag, tagName }, index) => (
            <!-- 动态延迟：index * 0.05s 实现极速级联展开 -->
            <li class="tag-item" style={`animation-delay: ${0.4 + index * 0.05}s`}>
              <Tag {tag} {tagName} />
            </li>
          ))}
        </ul>

      </div>
    </section>
  </main>
  
  <Footer />
</Layout>

<script>
  // 适配 Astro View Transitions，确保在页面切换时动画重新播放
  document.addEventListener("astro:page-load", () => {
    const animItems = document.querySelectorAll('.tag-item, .fade-in-up, .draw-line');
    animItems.forEach(item => {
      const el = item as HTMLElement;
      el.style.animation = 'none';
      el.offsetHeight; // 触发浏览器强制重绘
      el.style.animation = '';
    });
  });
</script>